<html>
    <style>
        .button.is-dark.is-small {
            font-family: 'IBM Plex Sans', sans-serif;
            background-color: #1a1a1a;
            border-color: white;
            color: #fff;
        }
        .button.is-dark.is-small:hover {
            font-family: 'IBM Plex Sans', sans-serif;
            background-color: #2a67f5;
            border-color: white;
            color: #fff;
        }
    </style>
</html>

# Code Pattern: Authenticate users on your chatbot with SMS one time passcode

[developer.ibm.com](https://developer.ibm.com/patterns/authenticate-users-on-your-chatbot-with-sms-one-time-passcode-otp/)

## Summary

In this code pattern, learn how to authenticate users on your chatbot with an SMS one-time passcode (OTP).

## Description

Chatbots are prevalent everywhere. And, some conversations are confidential, so chatbots must verify the authenticity of its users. One example of this is a customer who holds an insurance policy who uses a chatbot to get more information about that insurance policy. Sending a one-time passcode through SMS is a popular way to identify a user.

This code pattern shows how to build a chatbot that authenticates users through an SMS one-time passcode. You also learn to use IBM Watson Assistant, IBM Cloud Functions, and custom APIs to build this application.

After you have completed this code pattern, you understand how to:

- Build conversational interfaces into any application, device, or channel
- Run your application code without servers
- Build APIs to authenticate users on your chatbot
- Make external API calls through Watson Assistant

## Flow

![architecture](https://raw.githubusercontent.com/IBM/authenticate-users-on-your-chatbot-with-sms-otp/master/doc/source/images/architecture.png)

1. The user registers for a policy on the portal.

2. User data is stored in the database, and policy details are sent to the user’s phone number in an SMS through the Twilio Messaging API.

3. The user interacts with the chatbot and asks for confidential information that is related to the policy. Watson Assistant prompts the user to enter the OTP.

4. The query is sent to Watson Assistant, which in turn invokes IBM Cloud Functions to make an API call to the user-defined, back-end API for retrieving information.

5. The database is searched for the user’s phone number, and the OTP generated by the back-end API is sent to the user through Twilio.

6. The user enters the OTP in the chat application to authenticate themselves.

7. Watson Assistant validates the OTP by interacting with the back-end API.

8. The user-requested confidential information is fetched from the database if the OTP is valid.

9. IBM Cloud Functions returns the confidential information to Watson Assistant.

10. Watson Assistant displays the user-requested confidential information.

11. The user can see the confidential information in the chatbot.

## Instructions

This is an Interactive instructions, follow the steps to setup a working instance of the code pattern in the Developer Playground.

<!-- <a class="button is-dark is-small" title="Open Terminal" href="didact://?commandId=terminal-for-nodejs-container:new" >Open Terminal</a> -->

### 1. Clone the GitHub repository

<a class="button is-dark is-small" title="Open Terminal" href="didact://?commandId=terminal-for-nodejs-container:new" >Open Terminal</a>

<a class="button is-dark is-small" title="Clone the Repo" href="didact://?commandId=vscode.didact.sendNamedTerminalAString&text=nodejs%20terminal%202$$git%20clone%20https%3A%2F%2Fgithub.com%2FIBM%2Fauthenticate-users-on-your-chatbot-with-sms-otp.git%20%26%26%20cd%20authenticate-users-on-your-chatbot-with-sms-otp%2F%20%26%26%20cd%20custom-apis-for-authentication%20%26%26%20pip3%20install%20-r%20requirements.txt%20%26%26%20cd%20..%20%26%26%20cd%20node-web-application%20%20%26%26%20npm%20install%20%26%26%20cd%20.." >Get the Code Pattern on Playground</a>

### 2. Create and Configure Twilio Messaging Service

- Create a [Twilio service](https://www.twilio.com/try-twilio) account.
- Verify caller IDs.
- Create the Twilio Trial Number.
- Copy Account SID, Auth Token and Phone Number.

For detailed steps click [here.](https://github.com/IBM/authenticate-users-on-your-chatbot-with-sms-otp#2-setup-twilio-messaging-service)

### 3. Build and Configure DB APIs

You can build and run the APIs within the Developer Playground, click on **Build and Run** to start the application.

<a class="button is-dark is-small" title="Build and Run" href="didact://?commandId=vscode.didact.sendNamedTerminalAString&text=nodejs%20terminal%202$$cd%20custom-apis-for-authentication%20%26%26%20python3%20app.py">Build and Run</a>

Configure the APIs by entering the credentials copied in the previous steps and take a note of the APIs URL.

### 4. Set up Cloud Functions

- Create a Cloud Function Action [here](https://cloud.ibm.com/login?redirect=%2Ffunctions%2Fcreate%2Faction).
- Copy the code from [here](https://github.com/IBM/authenticate-users-on-your-chatbot-with-sms-otp/blob/master/cloud-function-action/otp-auth.py) and paste as in the canvas for cloud function action.

### 5. Create Watson Assistant Services

You need to be logged in to your IBM Cloud account in the Developer Playground to create and configure services.

<a class="button is-dark is-small" title="Open Terminal" href="didact://?commandId=terminal-for-nodejs-container:new" >Open new terminal</a><br/>

<a class="button is-dark is-small" title="Login to IBM Cloud" href="didact://?commandId=vscode.didact.sendNamedTerminalAString&text=nodejs%20terminal%203$$ibmcloud%20login%20--sso%20%26%26%20ibmcloud%20target%20--cf%20%26%26%20ibmcloud%20target%20-g%20Default">Login to IBM Cloud</a>

- Navigate to Watson Assistant Instance from [here](https://eu-gb.assistant.watson.cloud.ibm.com/instances).
- Follow the steps [here](https://github.com/IBM/authenticate-users-on-your-chatbot-with-sms-otp#6-import-watson-assistant-workspace) to import a Watson Assistant Skill and configure with Cloud Function URL.

### 6. Build and Run the Web App

You can build and run the APIs within the Developer Playground, click on **Build and Run** to start the application.
You can also manage the created services in [IBM Cloud Dashboard](https://cloud.ibm.com/resources).

<a class="button is-dark is-small" title="Build and Run" href="didact://?commandId=vscode.didact.sendNamedTerminalAString&text=nodejs%20terminal%203$$cd%20authenticate-users-on-your-chatbot-with-sms-otp%2Fnode-web-application%20%26%26%20node%20server.js">Build and Run</a>

You can stop the Apps by clicking on the below buttons.

<a class="button is-dark is-small" href="didact://?commandId=vscode.didact.sendNamedTerminalCtrlC&text=nodejs%20terminal%202">Stop Running APIs</a>
<a class="button is-dark is-small" href="didact://?commandId=vscode.didact.sendNamedTerminalCtrlC&text=nodejs%20terminal%203">Stop Running Web App</a>

### 7. Clean up
Completed the code pattern? Click on **Clean up** to delete the IBM Cloud services that were created.

<a class="button is-dark is-small" title="Delete services from IBM Cloud" href="didact://?commandId=vscode.didact.sendNamedTerminalAString&text=nodejs%20terminal%203$$servicename%3D%22cp-wa%22%20%26%26%20ibmcloud%20resource%20service-key-delete%20%22%24servicename-creds%22%20-f%20%26%26%20ibmcloud%20resource%20service-instance-delete%20%24servicename%20-f">Clean up</a>

Find the detailed steps [here](https://github.com/IBM/authenticate-users-on-your-chatbot-with-sms-otp#4-create-a-cloud-function-action).


You can find the detailed steps in the [README](didact://?commandId=vscode.didact.openTutorial&file="extract-textual-insights-from-video.git%20%26%26%20cd%20extract-textual-insights-from-video%2FREADME.md") file.
